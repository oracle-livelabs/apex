# DOMとjQueryの操作

## はじめに

JavaScriptは、Webブラウザー上でDOMを操作してイベントを処理する機能がなければ、役に立ちません。このラボでは、jQueryを使用して要素を選択し、操作する練習をします。さらに、コードを通じてイベント・ハンドラを追加する練習をすることで、その動作についてよりよく理解できます。

このラボのすべての作業は、ブラウザーのコンソールを通じて行われます。ただし、一旦理解されれば、前のラボで説明したテクニックを使用して、コードをAPEXアプリケーションに簡単に追加できます。

以下のビデオを視聴して、このラボの概要を学習してください。

[](youtube:uK7vCqfXxNs)

<a href="<https://www.slideshare.net/DanielMcGhan/module-3-working-with-the-dom-and-jquery>" target="\_blank">こちらをクリック</a>して、スライドをご覧ください。

## タスク1: DOMでの基本的な選択、トラバーサル、操作

jQueryを使用すると、要素の選択、DOMツリーのトラバーサル、必要に応じたDOMの変更が簡単になります。このステップでは、それを可能にするjQueryメソッドのいくつかを使用する練習をします。

1. APEXワークスペースにログインし、**アプリケーション・ビルダー > Sample Database Application**(前のラボでインストール済み)に移動して、アプリケーションを実行し、ログインします。ホームページが表示されるはずです。

   ![](images/sample-database-app-home.png " ")

2. ブラウザーの開発者ツールを開きます。右上隅にあるアプリケーションの検索用テキストを右クリックし、「検証」をクリックします。要素のidを特定します。

   ![](images/search-item.png)

   ご覧の通り、ページがレンダリングされると、APEXアイテムの**名前**が要素のidになります。複数の要素で構成されるより複雑なアイテム(チェックボックス、ラジオグループ、シャトルなど)の場合、**名前**はDOM上の少し上のコンテナ要素にマッピングされます。

   次に、コンソールを使用して、以下のコードを入力して実行し、アイテムを無効化します。

    ```
    <copy>
    $('#P1_SEARCH').attr('disabled', 'disabled');
    </copy>
    ```

   検索を実行して、コードが機能することを確認してください。アイテムを操作できないはずです。

   次に、以下のコードを実行して、アイテムを元の状態に戻します。

    ```
    <copy>
    $('#P1_SEARCH').removeAttr('disabled');
    </copy>
    ```

3. ブラウザーの開発者ツールを使用して、Dashboardリージョンのidを特定します。

   ![](images/dashboard-region.png)

   リージョンIDはデフォルトでランダムに生成されるため、**R2177368582615194411**のようなものが表示されるはずです。これらのIDはデプロイ時に通常変更されるため、JavaScriptコードで使用しない方がよいでしょう。

   ページ1、ホームページのページ・デザイナーに移動し、左のレンダリング・パネルでDashboardリージョンを選択します。右のプロパティ・パネルで、**静的ID**(詳細セクション内)に**dashboard-reg**を入力します。

   ページを再実行し、リージョンが新しい静的IDを使用していることを確認します。以下のコードを実行して、リージョンを選択して非表示にします。

    ```
    <copy>
    $('#dashboard-reg').hide();
    </copy>
    ```

   次に、以下のコードを実行して、リージョンを元の状態に戻します。

    ```
    <copy>
    $('#dashboard-reg').show();
    </copy>
    ```

   `hide`と`show`メソッドをそれぞれ`fadeOut`と`fadeIn`に置き換えて試すこともできます。

4. ブラウザーの開発者ツールを使用して、右上隅のナビゲーション・バーを調べます。

   ![](images/navigation-bar.png)

   ご覧の通り、ナビゲーション・バーはリンクを持つ複数の`li`要素を含む`ul`要素で構成されています。

   次のコードを実行して、`ul`内の2番目の`li`にクラスを追加します。

    ```
    <copy>
    $('.t-NavigationBar').children().eq(1).addClass('icon-only');
    </copy>
    ```

   次に、以下のコードを実行して、`li`アイテムを元の状態に戻します。

    ```
    <copy>
    $('.t-NavigationBar').children().eq(1).removeClass('icon-only');
    </copy>
    ```

## タスク2: イベントとイベント・デリゲーションの処理

このステップでは、基本的な通常のイベント・リスナーを作成し、APEXでイベント・デリゲーションが必要な理由を学習します。

1. Sample Database ApplicationのProductsページに移動します。以下のコードを実行して、レポート内の画像のクリック・イベントにイベント・ハンドラを追加します。

    ```
    <copy>
    $('img').on('click', function() {
      console.log('You clicked an image!');
    });
    </copy>
    ```

   コードの実行後、画像をクリックしてみてください。コンソールに「You clicked an image!」メッセージが表示されるはずです。

   次に、レポートの検索バーの`Go`ボタンをクリックして、もう一度画像をクリックしてみます。前のバインディングがない新しい要素で行が置き換えられたため、メッセージは表示されなくなります。次のステップでは、この問題を修正するためにイベント・デリゲーションを使用します。

2. 次のコードを実行して、レポートに1つのイベント・ハンドラを追加します。このイベント・ハンドラは、IDがproductsIRRの要素の下のレベルにある画像のクリック・イベントをリッスンします。

    ```
    <copy>
    $('#productsIRR').on('click', 'img', function() {
      console.log('You clicked an image!');
    });
    </copy>
    ```

   コードの実行後、動作を確認するためにいくつかの画像をクリックしてください。次に、`Go`ボタンをもう一度クリックし、さらに画像をクリックしてください。今回は、メッセージがコンソールに継続的に記録されるはずです。

3. イベント・デリゲーション、DOMのトラバーサル、DOM操作を使用したより完全な例として、次のコードを実行し、いくつかの画像をクリックしてください。

    ```
    <copy>
    $('#productsIRR').on('click', 'img', function() {
      $img = $(this);

      // DOMをトラバースして製品名を取得する
      productName = $img.parent('td').next('td').children('a').text();

      // クリックした画像の製品名を含むようにパンくずを変更する
      $('.t-Breadcrumb-label').text(productName + 'をクリックしました');
    });
    </copy>
    ```

   これは最も実用的な例ではありませんが、DOMとjQueryをよく理解することがどれほど強力であるかがわかり始めたのではないでしょうか。

## **まとめ**

これでラボ3が完了しました。この時点で、jQueryを使用してDOM要素を選択、トラバース、操作する方法についての良いアイデアが持てるはずです。さらに、イベントの動作原理とAPEXでイベントデリゲーションを使用する基本的な理解も得られるはずです。

## **謝辞**
 - **著者** -  Dan McGhan, Database Product Management
 - **寄稿者** - Arabella Yao, Jeffrey Malcolm Jr, Robert Ruppel, LiveLabs QA
 - **最終更新者/日付** - Jeffrey Malcolm, LiveLabs QA, June 2020

